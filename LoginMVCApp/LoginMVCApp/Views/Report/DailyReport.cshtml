@model List<LoginMVCApp.Models.Transactions>

@{
    ViewData["Title"] = "Daily Report - Scan Inventory";
}

<div class="container mt-5">
    <h2>Daily Report</h2>

    @if (Model != null && Model.Count > 0)
    {
        <form method="get" asp-action="DailyReport" class="row g-3 mb-3">
            <div class="col-md-3">
                <input type="date" name="startDate" value="@ViewBag.StartDate" class="form-control" />
            </div>
            <div class="col-md-3">
                <input type="date" name="endDate" value="@ViewBag.EndDate" class="form-control" />
            </div>
            <div class="col-md-2">
                <select name="shift" class="form-select" asp-items="ViewBag.ShiftList">
                    <option value="">-- Shift --</option>
                </select>

            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a asp-action="DailyReport" class="btn btn-secondary">Clear</a>
            </div>
        </form>

        <form asp-action="ExportDailyReport" method="get" style="display:inline;">
            <input type="hidden" name="startDate" value="@ViewBag.StartDate" />
            <input type="hidden" name="endDate" value="@ViewBag.EndDate" />
            <input type="hidden" name="shift" value="@ViewBag.SelectedShift" />
            <button type="submit" class="btn btn-success">Export to Excel</button>
        </form>


        <table class="table table-bordered table-hover align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>No</th>
                    <th>Inventory Id</th>
                    <th>Robot</th>
                    <th>Part</th>
                    <th>Project</th>
                    <th>Type</th>
                    <th>Color</th>
                    <th>Status</th>
                    <th>Detail NG</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Count; i++)
                {
                    var trans = Model[i];
                    <tr>
                        <td class="text-center">@( ( (ViewBag.Page - 1) * ViewBag.PageSize ) + i + 1 )</td>
                        <td>@trans.Barcode</td>
                        <td>@trans.Robot.Nama</td>
                        <td>@trans.Inventory?.PartName</td>
                        <td>@trans.Inventory?.Project</td>
                        <td>@trans.Inventory?.Tipe</td>
                        <td>@trans.Inventory?.Warna</td>
                        <td>@trans.Status</td>
                        <td>@trans.NgCategory?.SubCategory</td>
                    </tr>
                }
            </tbody>
        </table>

        @if (ViewBag.TotalItems > ViewBag.PageSize)
        {
            var totalPages = (int)Math.Ceiling((double)ViewBag.TotalItems / ViewBag.PageSize);
            <nav>
                <ul class="pagination">
                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(ViewBag.Page == i ? "active" : "")">
                            <a class="page-link"
                               asp-action="DailyReport"
                               asp-route-page="@i"
                               asp-route-pageSize="@ViewBag.PageSize"
                               asp-route-startDate="@ViewBag.StartDate"
                               asp-route-endDate="@ViewBag.EndDate"
                               asp-route-shift="@ViewBag.Shift">
                                @i
                            </a>
                        </li>
                    }
                </ul>
            </nav>
        }

    }
    else
    {
        <div class="alert alert-info text-center">
            Belum ada data transaksi yang tersedia.
        </div>
    }
</div>
